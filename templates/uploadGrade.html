
{% extends "bootstrap/base.html" %}
{% include 'layout.html' %}

{% block head %}
    <script  src="https://code.jquery.com/jquery-3.4.1.slim.min.js"  integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="  crossorigin="anonymous"></script>

    {{ super() }}
    <script type=text/javascript>
    $( document ).ready(function() {
        if({{ show }})
        {
            alert("{{ fileName }} is uploaded.")
        }

        function loadingfadeOut() {
            console.log("loadingfadeOut!");
            $('#loading').fadeOut();
        }

        function handleLoading() {
            console.log("loadingfadeIn!");
            $('#loading').fadeIn();
            {#$.post("{{ url_for('uploadGrade2DB') }}");#}
        }

        function afterLoading()
        {
            console.log("afterLoading!");
        }

        {#$("#uploadGrade").click( function () {#}
        {#    console.log($('#uploadForm')[0].checkValidity());#}
        {#    if($('#uploadForm')[0].checkValidity())#}
        {#    {#}
        {#        $('#loading').show();#}
        {#        $('#uploadForm :input').prop('disabled', true);#}
        {#        console.log("call uploadGrade2DB");#}
        {##}
        {#        $.post('{{ url_for('uploadGrade2DB') }}', {pVersion: $("#pVersion").val(), cTerm: $("#cTerm").val(), sLevel: $("#sLevel").val()} );#}
                {#$.ajax({#}
                    {#url: {{ url_for('uploadGrade2DB') }},#}
                {#    url: window.location.origin+"/uploadGrade2DB",#}
                {#    method: "POST",#}
                {#    data: {pVersion: $("#pVersion").val(), cTerm: $("#cTerm").val(), sLevel: $("#sLevel").val()},#}
                {#    success: afterLoading()#}
                {##}
        {#    }#}

    });
    </script>
{#    <style>#}
{#    #loading#}
{#    {#}
{#        position: absolute;#}
{#        left: 50%;#}
{#        top: 50%;#}
{#        z-index: 1;#}
{#    }#}
{#    </style>#}
{% endblock %}

{% block content %}

    <div class="container" >

      <div class="py-5 text-center">
        <h2 >Upload Students' Grade Report</h2>
        <p class="my-3 text-muted">Please upload the grade review report for students. The .csv file should contain the information such as term, program code, program name, course level, student number, student first name and last name,
        professor first and last name, course number, course title, letter grade, percent, faculty and review comments. </p>
          <hr class="mb-4">

            <form id="uploadForm" action="{{ url_for('uploadGrade2DB') }}" method="post" class="needs-validation" >
        <div class="form-row">
              <div class="col-md-4 mb-3">
                <label for="pVersion">Program Version</label>
                <select class="custom-select d-block w-100" id="pVersion" name="pVersion" required="">
                    <option value="">Choose...</option>
                    <option>2018-2019</option>
                    <option>2019-2020</option>
                </select>
                <div class="invalid-feedback">
                  Please select a valid program version.
                </div>
              </div>
              <div class="col-md-4 mb-3">
                <label for="cTerm">Course Term</label>
                <select class="custom-select d-block w-100" id="cTerm" name="cTerm" required="">
                    <option value="">Choose...</option>
                    <option>2019W</option>
                    <option>2019F</option>
                    <option>2020W</option>
                </select>
                <div class="invalid-feedback">
                  Please provide a valid course term.
                </div>
              </div>
              <div class="col-md-4 mb-3">
                <label for="sLevel">Student Level</label>
                <select class="custom-select d-block w-100" id="sLevel" name="sLevel" required="">
                    <option value="">Choose...</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                </select>
                <div class="invalid-feedback">
                  Please provide a valid course term.
                </div>
              </div>
            </div>


        <hr class="mb-4">
        <div class="input-group">
            <div class="invalid-feedback">
              Please choose a valid file.
            </div>
            <div class="custom-file">
                <input type="file" class="custom-file-input" accept=".csv" id="inputFile" name="inputFile" required>
                <label class="custom-file-label" for="inputFile">Choose .csv file</label>
            </div>


            <div class="input-group-append">
                <input type="submit" class="btn btn-success" value="Upload Grade" id="uploadGrade">
            </div>

        </div>
        </form>
      </div>
    </div>

{#    <div id="loading" style="display: none;">#}
{#      <img id="loading-image" src="static/ajax-loader.gif" alt="Loading..." />#}
{#    </div>#}

<script>
    document.querySelector('.custom-file-input').addEventListener('change',function(e){
      var fileName = document.getElementById("inputFile").files[0].name;
      var nextSibling = e.target.nextElementSibling
      nextSibling.innerText = fileName
    });
</script>

<footer class="container ">
  <p class="float-right">Â© Algonquin College 2019-2020</p>
</footer>


{% endblock %}

